# Prisma

## Prisma Client

The Prisma Client is a type-safe database client generated by Prisma based on your Prisma schema. It provides a set of methods for interacting with your database in a type-safe way.

### Prisma in Development

#### Local Development with Docker

1. **Prerequisites**

   - Docker and Docker Compose installed
   - `.env.development` file with database connection string

2. **Starting the development environment**

   ```bash
   # Build and start all services
   npm run docker:dev:up

   # Apply database migrations
   npm run docker:dev:db:migrate

   # Open Prisma Studio (in a new terminal)
   npm run docker:dev:studio
   ```

3. **Common development tasks**

   ```bash
   # Rebuild containers after dependency changes
   npm run docker:dev:build

   # Reset the database
   npm run docker:dev:db:rollback

   # Stop all services
   npm run docker:dev:down
   ```

### Prisma Client Generation

Prisma Client is automatically generated by running `npx prisma generate`.

#### When to run `prisma generate`

1. After modifying `schema.prisma`
2. Before building the application
3. After pulling new changes that include Prisma schema updates

### Database Migrations

Migrations are managed through the following commands:

```bash
# Create a new migration
npx prisma migrate dev --name migration_name

# Apply pending migrations
npx prisma migrate deploy
```

#### Migration Workflow

1. **Development**

   - Run `prisma migrate dev` to create and apply migrations
   - Migrations are automatically applied in development when using `docker-compose up`

2. **Production/Staging**
   - Migrations are applied automatically during deployment via `prisma migrate deploy`
   - Runs as part of the container startup process

### Using Prisma Client

```typescript
import { prisma } from '@/lib/prisma';

// Example query
const user = await prisma.user.findUnique({
  where: {
    id: 1,
  },
  include: {
    // Include related models
  },
});
```

### Prisma Studio

Access the Prisma Studio UI at `http://localhost:5555` when the development environment is running.

### Best Practices

1. **Schema Changes**:

   - Always create migrations for schema changes
   - Test migrations in development before applying to production

2. **Environment Variables**:

   - Database connection strings should be managed through environment variables
   - Never commit sensitive information to version control

3. **Development Workflow**:
   - Use `docker-compose` for consistent development environments
   - Reset the development database using `npm run docker:dev:db:rollback` when needed
